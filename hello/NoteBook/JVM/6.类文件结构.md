# 第六章 类文件结构

------

[TOC]

------

## 1. 概述

​		计算机只能识别01代码,而不同系统对01代码的识别也不一样.运行在虚拟机上成为了一种重要的跨平台手段.

## 2. 无关性的基石

​		构成平台无关性的基石就是不同虚拟机和所有平台都统一使用的程序存储格式--字节码(ByteCode).

​		实现语言无关性的基础仍然是虚拟机和字节码存储格式,Java虚拟机只与Class文件这种特定的二进制文件格式所关联.

## 3. Class文件的结构

​		这里以JDK1.4时代的Java虚拟机中的定义为主线.

​		Class文件是一组以8位字节为基础单位的二进制流,各个数据项目严格按照顺序紧凑的排列在一起,中间没有任何分隔符.当遇到需要占用8字节以上空间的数据项时,会按照高位在前的方式分割成若干8位字节进行存储.

​		Java虚拟机,Class文件格式采用一种类似与C语言结构体的伪结构来存储数据,这种伪结构只有两种数据类型:**<u>无符号数</u>**和**<u>表</u>**.

​		<u>**无符号数属于基本的数据类型,以u1,u2,u4,u8来代表1个字节,2个字节,4个字节和8个字节的无符号数,无符号数可以用来描述数字,索引引用,数量质或者UTF-8编码的字符串值.****</u>

​		<u>**表是由多个无符号数或者其他表作为数据项构成的复合型数据类型.所有表都习惯性的以"_info"结尾.**</u>

​		无论是无符号数还是表,当需要描述同一类型但数量不定的多个数据时,常使用一个前置的容量计数器和若干个连续的数据项的形式,这是这连续若干个数据项就被称为某一类型的集合

### (1).  魔数与Class文件的版本

​		每个Class文件的**<u>头4个字节成为魔数</u>**,他的唯一作用就是确定这个文件是否是一个能被虚拟机接受的Class文件.

​		Class文件的魔值为0xCAFEBABE(咖啡宝贝....,可能后来logo也跟这个有关系).

​		**<u>紧接着的4个字节存储的是Class文件的版本号</u>**:第5和第6字节是次版本号,第7和第8字节是主版本号.

### (2). 常量池

​		紧接着主次版本号之后的是常量池入口,常量池可以理解为**<u>Class文件之中的资源仓库</u>**.,它是Class文件结构中与其他项目关联最多的数据类型,也是**<u>占用Class文件空间最大的数据项目之一</u>**.

​		常量池的入口放置一项**<u>u2类型</u>**的数据代表**<u>常量池容量计数值</u>**.这个值从1开始计数.索引0表示不引用任何常量池项目.