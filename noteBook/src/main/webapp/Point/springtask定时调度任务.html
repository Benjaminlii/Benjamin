<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>springtask定时调度任务</title>
</head>
<body>
<h1><a name="header-n90" class="md-header-anchor md-print-anchor" href="af://n90"> </a><span>spring task定时调度任务</span>
</h1>
<h2><a name="header-n91" class="md-header-anchor md-print-anchor" href="af://n91"> </a><span>1.spring task介绍</span></h2>
<p><span>spring task是spring3.0之后自助开发的定时任务工具,使用起来很简单,只需要提供spring相关jar包就可以使用,并且支持注解和配置文件两种形式.</span></p>
<h2><a name="header-n93" class="md-header-anchor md-print-anchor" href="af://n93"> </a><span>2.配置文件方式实现</span></h2>
<h4><a name="header-n94" class="md-header-anchor md-print-anchor" href="af://n94"> </a><span>1.普通的pojo类</span></h4>
<pre><code class='language-java' lang='java'>@Service
public class TaskJob {
    public void job1() {
        System.out.println(“任务进行中。。。”);
    }
}
</code></pre>
<h4><a name="header-n96" class="md-header-anchor md-print-anchor" href="af://n96"> </a><span>2.spring task配置文件</span>
</h4>
<pre><code class='language-xml' lang='xml'>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:task=&quot;http://www.springframework.org/schema/task&quot;
       ......
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/task
                           http://www.springframework.org/schema/task/spring-task-3.0.xsd&quot;&gt;

      &lt;task:scheduled-tasks&gt;
          &lt;task:scheduled ref=&quot;taskJob&quot; method=&quot;job1&quot; cron=&quot;0 * * * * ?&quot;/&gt;
      &lt;/task:scheduled-tasks&gt;
      &lt;context:component-scan base-package=&quot; com.gy.mytask &quot; /&gt;
&lt;/beans&gt;
</code></pre>
<p><span>每一个定时任务都需要在spring配置文件中</span><a href='task:scheduled-tasks' target='_blank'
                                         class='url'>task:scheduled-tasks</a><span>标签内进行一条配置</span><a
        href='task:scheduled' target='_blank' class='url'>task:scheduled</a><span>.</span></p>
<p><span>ref指定时任务所在的类在spring容器中Javabean的id,method值指需要定时去执行的任务.</span></p>
<p><span>Javabean需要配置进spring容器(注解或者配置文件)</span></p>
<h2><a name="header-n101" class="md-header-anchor md-print-anchor" href="af://n101"> </a><span>3.使用注解方式实现</span></h2>
<p><span>大致与配置文件形式相同.只需要将task:scheduled-tasks标签去除,并且加上以下标签:</span></p>
<pre><code class='language-xml' lang='xml'>&lt;task:annotation-driven/&gt;
</code></pre>
<p><span>在需要定时执行的方法上加上一下注解,给出例子:</span></p>
<pre><code class='language-java' lang='java'>@Component
public class TimerManager {

    @Autowired
    private Service ervice;

    /**
     * @Scheduled 内cron表达式限定方法执行的时间
     */
    @Scheduled(cron = &quot;0/5 * * * * ?&quot;)
    public void generateIncomePlan(){
        logger.info(&quot;---------------定时任务开始--------------&quot;);

        service.doSomeThing();

        logger.info(&quot;---------------定时任务结束--------------&quot;);
    }
}
</code></pre>
<h2><a name="header-n106" class="md-header-anchor md-print-anchor" href="af://n106"> </a><span>4.crom表达式</span></h2>
<ol>
    <li><p><span>cron表达式的格式</span></p>
        <p><span>秒   分   时   日   月   周   [年]</span></p>
    </li>
    <li><p><span>各个字段的取值</span></p>
        <figure>
            <table>
                <thead>
                <tr>
                    <th><span>字段名</span></th>
                    <th><span>允许的值</span></th>
                    <th><span>允许的特殊字符</span></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><span>秒</span></td>
                    <td><span>0~59</span></td>
                    <td><span>,  -  *  /</span></td>
                </tr>
                <tr>
                    <td><span>分</span></td>
                    <td><span>0~59</span></td>
                    <td><span>,  -  *  /</span></td>
                </tr>
                <tr>
                    <td><span>时</span></td>
                    <td><span>0~23</span></td>
                    <td><span>,  -  *  /</span></td>
                </tr>
                <tr>
                    <td><span>日</span></td>
                    <td><span>1~31</span></td>
                    <td><span>,  -  *  ?  /  L  W  C</span></td>
                </tr>
                <tr>
                    <td><span>月</span></td>
                    <td><span>1~12   or   JAN~DEC</span></td>
                    <td><span>,  -  *  /</span></td>
                </tr>
                <tr>
                    <td><span>周</span></td>
                    <td><span>1~7   or   SUN~SAT  (1~7指从周日到周六)</span></td>
                    <td><span>,  -  *  ?  /  L  C  #</span></td>
                </tr>
                <tr>
                    <td><span>[年]</span></td>
                    <td><span>1970~2099  or  empty</span></td>
                    <td><span>,  -  *  /</span></td>
                </tr>
                </tbody>
            </table>
        </figure>
    </li>
    <li><p><span>特殊字符的意义</span></p>
        <figure>
            <table>
                <thead>
                <tr>
                    <th><span>特殊字符</span></th>
                    <th><span>表示的意义</span></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><span>,</span></td>
                    <td><span>表示枚举的值(周中使用 1,2,3 表示每周的周日周一周二都执行)</span></td>
                </tr>
                <tr>
                    <td><span>-</span></td>
                    <td><span>表示范围(周中使用 1-5 表示从周一至周四都执行)</span></td>
                </tr>
                <tr>
                    <td><span>*</span></td>
                    <td><span>表示任意值</span></td>
                </tr>
                <tr>
                    <td><span>/</span></td>
                    <td><span>表示一个值的增加幅度(n/m表示从n开始每次增加m)</span></td>
                </tr>
                <tr>
                    <td><span>?</span></td>
                    <td><span>表示不确定的值.只用在日和周中,如果其中一个出现了</span><em><span>,另一个要匹配其意义,不能使用</span></em><span>表示任意,应使用?表示满足之前的*的任意值</span>
                    </td>
                </tr>
                <tr>
                    <td><span>L</span></td>
                    <td><span>在日中表示一个月中的最后一天,用在周中表示当月的最后一个周x(xL,x可省略,默认为7,周六)</span></td>
                </tr>
                <tr>
                    <td><span>W</span></td>
                    <td><span>只能出现在日期字段中,表示距离x日最近的工作日(xW),(日期字段中使用LW表示当月的最后一个工作日)</span></td>
                </tr>
                <tr>
                    <td><span>#</span></td>
                    <td><span>(x#y)表示当月的第7个周x(x为数字表示的周)</span></td>
                </tr>
                </tbody>
            </table>
        </figure>
    </li>
    <li><p><span>Cron生成</span></p>
        <p><a href='http://cron.qqe2.com/' target='_blank' class='url'>http://cron.qqe2.com/</a></p>
    </li>

</ol>

</body>
</html>